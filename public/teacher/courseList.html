<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance for Course Batch - AMU Attendance Portal</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="shortcut icon" href="../assets/favicon.svg" type="image/x-icon">
</head>
<body>
    <div class="Dashboard-container">
        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="navbar-container">
                <a href="./teacherDashboard.html"><img src="../assets/logoWithName.png" alt="AMU Logo with name" class="logo"></a>
                <!-- Dropdown Menu -->
                <div class="dropdown">
                    <button class="dropbtn">
                        <img id="teacher-image" src="../assets/user'sPic.jpeg" alt="Teacher Image" class="student-image"> 
                        Teacher Name &#9662;
                    </button>
                    <div class="dropdown-content">
                        <a href="./profile.html"><i class="fa-regular fa-address-card fa-fade"></i> Profile</a>
                        <a href="./teacherLogin.html"><i class="fa-solid fa-arrow-right-from-bracket fa-fade"></i> <i class="fa-solid fa-person-walking fa-fade"></i> Logout</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Student List and Attendance Section -->
        <section class="cards-section">
            <div class="card">
                <h3 id="course-title">Course: </h3>
                <div id="student-list">
                    <!-- Student list with attendance toggles will be dynamically inserted here -->
                </div>
            </div>
        </section>

        <footer>
            <p><i class="fa-solid fa-code fa-fade"></i> Developed by <a href="https://github.com/mohdyusuf2312" target="_blank"><strong>Mohd Yusuf</strong></a></p>
        </footer>
    </div>

    <script src="../script/slideshow.js"></script>
    <script src="https://kit.fontawesome.com/740d826d31.js" crossorigin="anonymous"></script>

    <script>
        // Fetch the teacher name from localStorage and display it in the navbar
        document.addEventListener("DOMContentLoaded", () => {
            const teacherName = localStorage.getItem("teacherName") || "Teacher Name"; // Fallback in case name is not available
            document.querySelector(".dropbtn").innerHTML = `
                <img id="teacher-image" src="../assets/user'sPic.jpeg" alt="Teacher Image" class="student-image"> 
                ${teacherName} &#9662;
            `;
        });

        // Dummy student data for demonstration
        const studentsData = [
            { enrollment_number: 'MCA2021_01', name: 'John Doe' },
            { enrollment_number: 'MCA2021_02', name: 'Jane Smith' },
            { enrollment_number: 'MCA2021_03', name: 'Alice Johnson' },
            { enrollment_number: 'MCA2021_04', name: 'Robert Brown' },
            { enrollment_number: 'MCA2021_05', name: 'Lucy Davis' },
            { enrollment_number: 'MCA2021_06', name: 'William Clark' },
            // More students here...
        ];

        // Fetch course parameter from URL
        const urlParams = new URLSearchParams(window.location.search);
        const selectedCourse = urlParams.get('course');
        
        // Update course title dynamically
        document.getElementById('course-title').textContent = `Course: ${selectedCourse.replace('_', ' ')}`;

        // Render student list with toggle buttons for attendance
        const studentListContainer = document.getElementById('student-list');

        studentsData.forEach(student => {
            const studentElement = document.createElement('div');
            studentElement.className = 'student-item';

            studentElement.innerHTML = `
                <div class="student-item">
                    <span class="student-enrollment"><strong>${student.enrollment_number}</strong></span>
                    <span class="student-name">${student.name}</span>
                    <div class="attendance-container">
                        <label class="attendance-toggle">
                            <input type="checkbox" class="attendance-checkbox" data-enrollment="${student.enrollment_number}">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            `;


            studentListContainer.appendChild(studentElement);
        });

        // Function to handle attendance marking
        function markAttendance(enrollmentNumber, status) {
            fetch('http://localhost:3000/api/attendance/mark', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    enrollment_number: enrollmentNumber,
                    status: status ? 'present' : 'absent',
                    course: selectedCourse
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Attendance marked:', data);
            })
            .catch(error => {
                console.error('Error marking attendance:', error);
            });
        }

        // Add event listeners to attendance checkboxes
        document.querySelectorAll('.attendance-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const enrollmentNumber = this.getAttribute('data-enrollment');
                const status = this.checked;
                markAttendance(enrollmentNumber, status);
            });
        });
    </script>
</body>
</html>
